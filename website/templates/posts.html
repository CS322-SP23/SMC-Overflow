<!DOCTYPE html>
<html>
  <head>
    <link rel="shortcut icon" href="#">
    <title>SMC Overflow</title>
    <style>
      .header {
      text-align: center;
      background-color: #532884;
      padding: 20px;
      }

      .navbar {
      display: flex;
      justify-content: center;
      background-color: #532884;
      height: px; /* Adjust the height as per your requirement */
      }

      .navbar nav {
      display: flex;
      gap: 20px;
      height: 100%; /* Set the height to 100% to fill the navbar */
      }

      .navbar a {
      font-size: 24px;
      text-decoration: none;
      color: #F5A00F;
      padding: 10px 10px; /* Increase the padding to create more height */
      border-radius: 5px;
      background-color: #532884;
      }


      .navbar a:hover {
      background-color: #8c57a7; /* lighter shade of the background color */
      }
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }

      .back-button {
        max-width: 10%;
        background-color: #532884;
        color: #F5A00F;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
      }

      #posts {
        display: block;
        margin-top: 20px;
        margin-left: auto;
        margin-right: auto;
        padding: 20px;
      }

      .post {
        margin-left: auto;
        margin-right: auto;
        width: calc(33.33% - 20px);
        margin-bottom: 20px;
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0px 3px 5px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .post h2 {
        font-size: 24px;
        font-weight: bold;
        margin: 0;
        padding: 20px;
        background-color: #F5A00F;
        color: #532884;
      }

      .post h3 {
        font-size: 18px;
        margin: 0;
        padding: 10px;
        margin-left:15px;
        color: #880ca7;

      }

      .post p {
        font-size: 16px;
        margin: 0;
        padding: 20px;
      }

      .dropdown {
        max-width: 10%;
        background-color: #532884;
        color: #F5A00F;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
      }

      .dropdown select {
        color: #F5A00F;
        background-color: #532884;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
      }

      .dropdown select:focus {
        outline: none;
      }

      .dropdown option {
        color: #F5A00F;
        background-color: #532884;
        padding: 5px 10px;
      }

      .dropdown-collapsed option::before {
        content: attr(data-abbreviation);
        font-weight: bold;
        margin-right: 5px;
      }
    </style>
      <div class="navbar">
        <nav>
          <a href= "/">Home</a>
          <a href= "/profile_page">Profile</a>
          <a href= "/logout">Logout</a>
        </nav>
        </div>
  </head>
  <body>
    <a href="/" class="back-button">Back</a>
    <select id="sort-dropdown" class="dropdown">
      <option value="">Sort By</option>
      <optgroup label="Popularity">
        <option value="0">Popularity: Low to High</option>
        <option value="1">Popularity: High to Low</option>
      </optgroup>
      <optgroup label="Recency">
        <option value="2">Recency: Old to New</option>
        <option value="3" selected>Recency: New to Old</option>
      </optgroup>
      <optgroup label="Answers">
        <option value="4">Unanswered</option>
        <option value="5">Most Answers</option>
      </optgroup>
    </select>
    <select id="cat-dropdown" required class="dropdown dropdown-collapsed">
      <option value="All">All</option>
      <option value="Africana Studies" data-abbreviation="AFST">Africana Studies</option>
      <option value="American Studies" data-abbreviation="AMST">American Studies</option>
      <option value="Anthropology and Sociology" data-abbreviation="ANSO">Anthropology and Sociology</option>
      <option value="Art and Art History" data-abbreviation="ART">Art and Art History</option>
      <option value="Arts Administration" data-abbreviation="AADM">Arts Administration</option>
      <option value="Asian Studies" data-abbreviation="ASIA">Asian Studies</option>
      <option value="Astronomy" data-abbreviation="Astronomy">Astronomy</option>
      <option value="Biochemistry" data-abbreviation="BCHM">Biochemistry</option>
      <option value="Biology" data-abbreviation="BIOL">Biology</option>
      <option value="Business and Management" data-abbreviation="BUS">Business and Management</option>
      <option value="Chemistry" data-abbreviation="CHEM">Chemistry</option>
      <option value="Chinese" data-abbreviation="CHIN">Chinese</option>
      <option value="Classics and Ancient Mediterranean Studies" data-abbreviation="CLAS">Classics and Ancient Mediterranean Studies</option>
      <option value="Computer Science" data-abbreviation="CS">Computer Science</option>
      <option value="Dance" data-abbreviation="DANC">Dance</option>
      <option value="Data Science" data-abbreviation="Data Science">Data Science</option>
      <option value="Earth Science" data-abbreviation="Earth Science">Earth Science</option>
      <option value="Economics" data-abbreviation="ECON">Economics</option>
      <option value="Educational Studies" data-abbreviation="EDUC">Educational Studies</option>
      <option value="Engineering" data-abbreviation="Engineering">Engineering</option>
      <option value="English" data-abbreviation="ENG">English</option>
      <option value="Environmental Studies" data-abbreviation="ENVS">Environmental Studies</option>
      <option value="Film Studies" data-abbreviation="FILM">Film Studies</option>
      <option value="French" data-abbreviation="FREN">French</option>
      <option value="Gender and Women's Studies" data-abbreviation="GWST">Gender and Women's Studies</option>
      <option value="German" data-abbreviation="GERM">German</option>
      <option value="Health Studies" data-abbreviation="Health Studies">Health Studies</option>
      <option value="History" data-abbreviation="HIST">History</option>
      <option value="Interdisciplinary Studies" data-abbreviation="IDIS">Interdisciplinary Studies</option>
      <option value="International Relations" data-abbreviation="IR">International Relations</option>
      <option value="International Studies" data-abbreviation="IS">International Studies</option>
      <option value="Japanese" data-abbreviation="JAPN">Japanese</option>
      <option value="Journalism" data-abbreviation="JOUR">Journalism</option>
      <option value="Latin American Studies" data-abbreviation="LAST">Latin American Studies</option>
      <option value="Law" data-abbreviation="Law">Law</option>
      <option value="Mathematics" data-abbreviation="MATH">Mathematics</option>
      <option value="Medicine" data-abbreviation="Medicine">Medicine</option>
      <option value="Modern Languages" data-abbreviation="MODL">Modern Languages</option>
      <option value="Music" data-abbreviation="MUS">Music</option>
      <option value="Neuroscience" data-abbreviation="NEUR">Neuroscience</option>
      <option value="Nursing" data-abbreviation="Nursing">Nursing</option>
      <option value="Occupational Therapy" data-abbreviation="Occupational Therapy">Occupational Therapy</option>
      <option value="Optometry" data-abbreviation="Optometry">Optometry</option>
      <option value="Peace and Justice" data-abbreviation="PJST">Peace and Justice</option>
      <option value="Philosophy" data-abbreviation="PHIL">Philosophy</option>
      <option value="Physics" data-abbreviation="PHYS">Physics</option>
      <option value="Political Science" data-abbreviation="PS">Political Science</option>
      <option value="Psychology" data-abbreviation="PSYC">Psychology</option>
      <option value="Theatre" data-abbreviation="THTR">Theatre</option>
    </select>
    <div id="posts"></div>
    <script>

      // Fetch the JSON data
      fetch('/data')
        .then(response => response.json())
        .then(posts => {
          const postsDiv = document.getElementById('posts');

          // Loop through the posts array
          posts.forEach(post => {
            // Create the HTML elements for each post
            const postDiv = document.createElement('div');
            postDiv.classList.add('post');
            postDiv.innerHTML = `
              <h2>${post.title}</h2>
              <h3>${post.username}</h3>
              <h3>Category: ${post.category}</h3>
              <p>${post.question}</p>
              <p>Rating: <span class="rating" data-post-id="${post.question_id}">${post.rating}</span></p>
              <button onclick="increaseRating(${post.question_id})">Increase Rating</button>
              <button onclick="decreaseRating(${post.question_id})">Decrease Rating</button>
              <a href="/viewpost/${post.question_id}" class="btn">View Post</a>
            `;

            // Add the post to the page
            postsDiv.appendChild(postDiv);
          });
        })
        .catch(error => console.error(error));

        function updatePosts() {
          var sort = document.getElementById('sort-dropdown').value;
          var cat = document.getElementById('cat-dropdown').value;
          
          fetch(`/data?sort=${sort}&category=${cat}`)
            .then(response => response.json())
            .then(posts => {
              const postsDiv = document.getElementById('posts');
              postsDiv.innerHTML = ''; // Clear the existing posts

              // Loop through the retrieved posts and create HTML elements for each post
              posts.forEach(post => {
                const postDiv = document.createElement('div');
                postDiv.classList.add('post');
                postDiv.innerHTML = `
                  <h2>${post.title}</h2>
                  <h3>${post.username}</h3>
                  <h3>Category: ${post.category}</h3>
                  <p>${post.question}</p>
                  <p>Rating: <span class="rating" data-post-id="${post.question_id}">${post.rating}</span></p>
                  <button onclick="increaseRating(${post.question_id})">Increase Rating</button>
                  <button onclick="decreaseRating(${post.question_id})">Decrease Rating</button>
                  <a href="/viewpost/${post.question_id}" class="btn">View Post</a>
                `;
                postsDiv.appendChild(postDiv); // Add the post to the page
              });
            })
            .catch(error => console.error(error));
        }

        document.getElementById('sort-dropdown').addEventListener('change', updatePosts);
        document.getElementById('cat-dropdown').addEventListener('change', updatePosts);

        function increaseRating(postId) {
          fetch(`/increase-rating/${postId}`)
            .then(response => response.json())
            .then(data => {
              const ratingElements = document.querySelectorAll(`.rating[data-post-id="${postId}"]`);
              ratingElements.forEach(element => {
                element.innerText = data.rating;
              });
            })
            .catch(error => console.error(error));
        }

        function decreaseRating(postId) {
          fetch(`/decrease-rating/${postId}`)
            .then(response => response.json())
            .then(data => {
              const ratingElements = document.querySelectorAll(`.rating[data-post-id="${postId}"]`);
              ratingElements.forEach(element => {
                element.innerText = data.rating;
              });
            })
            .catch(error => console.error(error));
        }

        

    </script>
  </body>
</html>
